# java21-crypto-on-and-off-ramp

## AlchemyPay 全流程架構圖

                    ┌─────────────────────┐
                    │   用戶前端 / App     │
                    └─────────┬───────────┘
                              │
                              │ 選擇幣種 / 法幣 / 金額
                              │
                              ▼
                    ┌─────────────────────┐
                    │    後端 Server       │
                    └─────────┬───────────┘
                              │
            ┌─────────────────┴─────────────────┐
            │                                   │
            ▼                                   ▼
┌─────────────────────┐             ┌─────────────────────┐
│ 支援幣種 /法幣查詢     │             │   即時報價 / 匯率     │
│ / SupportedCoins    │             │     / Quote API     │
└─────────┬───────────┘             └─────────┬───────────┘
│                                   │
▼                                   ▼
┌─────────────────────┐             ┌─────────────────────┐
│      建立訂單        │             │      計算支付金額     │
│ / Create Order API   │◀──────────▶│   (含手續費 / 匯率)   │
└─────────┬───────────┘             └─────────┬───────────┘
          │                                   │
          ▼                                   ▼
┌──────────────────────┐             ┌─────────────────────┐
│  回傳支付鏈接 / QR     │             │    Body MD5 / Sign  │
│  redirectUrl / fail  │             │  (SHA1 / HMAC / MD5)│
│  RedirectUrl / Fail  │             └─────────────────────┘
└─────────┬────────────┘
          │
          ▼
┌─────────────────────┐
│   用戶付款 (前端)     │
└─────────┬───────────┘
          │
┌─────────┴─────────┐
│                   │
▼                   ▼
成功付款            付款失敗 / 超時
redirectUrl         failRedirectUrl / Pending
(SUCCESS)           (FAILED / TIMEOUT)

            │
            ▼
┌─────────────────────┐
│  AlchemyPay Webhook │
│  (訂單狀態回調)       │
│  status: SUCCESS    │
│  status: FAILED     │
│  merchantOrderNo    │
│  returnCode / Msg   │
└─────────┬───────────┘
          │
          ▼
┌─────────────────────┐
│ 後端 Server 處理回調  │
│ - 驗簽 (Signature)   │
│ - 訂單狀態更新        │
│ - 失敗重試邏輯        │
│ - 部分退款 / 對帳     │
└─────────┬───────────┘
          │
          ▼
┌─────────────────────┐
│ 後端 / 前端顯示結果    │
│ - 成功頁 / 失敗頁     │
│ - 訂單歷史 / 對帳報表  │
└─────────────────────┘
